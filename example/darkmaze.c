//8x8x2
char character[] = {0x77,0xbb,0xc0,0x2,0x7,0xcc,0xcc,0x2,0xc,0xc1,0x71,0x8,0xaa,0x7a,0x7a,0x8,0xcc,0xba,0xaa,0xb7,0x7b,0xba,0xaa,0x8,0x6,0x66,0xa6,0x0,0xc,0x0,0xc,0x0,0x77,0xbb,0xc0,0x20,0x7,0xcc,0xcc,0x20,0xc,0xc1,0x71,0x80,0xaa,0x7a,0x7a,0x80,0xac,0xba,0xaa,0x70,0x7,0xba,0xaa,0x80,0x6,0x66,0xa6,0x0,0x0,0xc0,0xc0,0x0};
//8x8	
char w[] = {0xff,0xff,0xff,0xfb,0xfc,0xcf,0xcc,0xcb,0xff,0xcc,0xcc,0xcb,0xfc,0xcc,0xbc,0xbb,0xfc,0xbc,0xcc,0xcb,0xfc,0xcc,0xcb,0xcb,0xfc,0xcc,0xbc,0xcb,0xff,0xbb,0xbb,0xbb};
char d[] = {0xff,0xff,0xff,0xfb,0xfc,0xcf,0xcc,0xcb,0xff,0xb2,0x2a,0xcb,0xfb,0x22,0x22,0xab,0xfb,0x22,0x22,0xab,0xfb,0x22,0x22,0xab,0xfb,0x22,0x22,0xab,0xfb,0x22,0x22,0xab};
//32x32 rle
char shadow[] = {0x7,0xbb,0x3,0xb,0xb,0xbb,0x83,0xb0,0x0,0x3,0xb0,0xa,0xbb,0x84,0x0,0xb,0xb0,0x2,0x0,0x3,0xb,0x7,0xbb,0x83,0x0,0xbb,0x7,0x0,0x82,0xb0,0x5,0xbb,0x2,0xb0,0x7,0x0,0x3,0xb,0x4,0xbb,0x82,0xb,0x9,0x0,0x3,0xb,0x3,0xbb,0x83,0x0,0xb0,0x9,0x0,0x2,0xb0,0x2,0xbb,0x83,0xb0,0xb,0x2,0x0,0x82,0xb0,0x7,0x0,0x2,0xb,0x2,0xbb,0x82,0xb,0xc,0x0,0x82,0xb0,0x2,0xbb,0x82,0xb0,0xd,0x0,0x84,0xbb,0xb0,0xb,0xc,0x0,0x2,0xb,0x82,0xbb,0xe,0x0,0x82,0xbb,0x2,0xb0,0xc,0x0,0x2,0xb,0x82,0xbb,0xe,0x0,0x2,0xb0,0xe,0x0,0x2,0xb,0xe,0x0,0x2,0xb0,0xe,0x0,0x2,0xb,0xf,0x0,0x84,0xb0,0x0,0xb,0xc,0x0,0x82,0xb,0xf,0x0,0x3,0xb0,0xd,0x0,0x84,0xb,0x0,0xb,0xd,0x0,0x2,0xbb,0xd,0x0,0x2,0xb,0x82,0xb0,0xd,0x0,0x82,0xb0,0x2,0xbb,0x82,0xb0,0xc,0x0,0x82,0xb,0x2,0xbb,0x82,0xb,0xb,0x0,0x2,0xb0,0x2,0xbb,0x2,0xb0,0x9,0x0,0x3,0xb,0x3,0xbb,0x2,0xb,0x7,0x0,0x82,0xb,0x2,0xb0,0x4,0xbb,0x2,0xb0,0x82,0xb,0x6,0x0,0x82,0xb0,0x2,0xb,0x5,0xbb,0x83,0xb,0x0,0x2,0xb0,0x2,0x0,0x3,0xb,0x82,0xb0,0x6,0xbb,0x83,0xb0,0xbb,0x4,0xb,0x82,0x0,0x2,0xb0,0xa,0xbb,0x3,0xb0,0x7,0xbb};

int maze[][] = {
	{w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w},
	{w,0,0,w,0,0,0,w,0,0,0,0,0,0,0,w},
	{w,0,0,w,0,w,0,w,0,w,0,w,0,w,0,w},
	{w,0,0,w,0,w,0,w,0,w,0,w,0,w,0,w},
	{w,0,0,0,0,0,0,w,0,w,0,w,0,w,0,w},
	{w,w,w,w,w,0,0,w,0,w,0,w,0,w,0,w},
	{w,0,0,0,0,0,0,w,0,w,0,w,0,w,0,w},
	{w,w,w,0,w,w,w,w,0,w,0,w,0,w,0,w},
	{w,0,0,0,0,0,0,w,0,w,0,w,0,w,0,w},
	{w,0,w,w,w,w,0,w,0,w,w,w,0,w,0,w},
	{w,0,0,0,0,w,0,0,0,0,0,w,0,w,0,w},
	{w,w,w,w,w,w,w,w,w,w,w,w,0,w,0,w},
	{w,0,0,0,0,0,0,0,0,0,0,0,0,w,0,w},
	{w,0,w,w,w,w,w,w,w,w,w,w,w,w,0,w},
	{w,d,w,0,0,0,0,0,0,0,0,0,0,0,0,w},
	{w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w}
}

int frame = 0, key, x, y, isPlay;

void init(){
	x = 1;
	y = 1;
	isPlay = 1;
	setcolor(4);
	setbgcolor(11);
	getsprite(1, character);
	loadtile(maze, 8, 8, 16, 16);
}

void step(){
	if(!gettimer(0)){
		settimer(0, 400);
		frame = 1 - frame;
	}
	if(!gettimer(1)){
		settimer(1, 100);
	}
	else{
		return;
	}
	key = getkey();
	if(key == KEY_UP){
		if(gettileinxy(x * 8, (y - 1) * 8) != w){
			y--;
		}
	}
	if(key == KEY_DOWN){
		if(gettileinxy(x * 8, (y + 1) * 8) != w){
			y++;
		}
	}
	if(key == KEY_LEFT){
		if(gettileinxy((x - 1) * 8, y * 8) != w){
			x--;
		}
	}
	if(key == KEY_RIGHT){
		if(gettileinxy((x + 1) * 8, y * 8) != w){
			x++;
		}
	}
	if(gettileinxy(x * 8, y * 8) == d){
		isPlay = 0;
	}
}

void draw(){
	setclip(0, 0, 128, 128);
	clearscreen();
	setclip(x * 8 - 12, y * 8 - 12, 32, 32);
	fillrect(0, 0, 128, 128);
	drawtile(0, 0);
	putimagerle(shadow, x * 8 - 12, y * 8 - 12, 32, 32);
	getsprite(1, character + frame * 32);
	putsprite(1, x * 8, y * 8);
	delayredraw();
}

void main(){
	init();
	while(isPlay){
		step();
		draw();
	}
	setclip(0, 0, 128, 128);
	clearscreen();
	drawtile(0, 0);
	setcolor(1);
	gotoxy(1, 8);
	puts("You found a way out.");
}